# 医学智能文献检索与综述生成系统 - 使用说明书

## 目录
- [项目概述](#项目概述)
- [系统功能](#系统功能)
- [环境要求](#环境要求)
- [安装指南](#安装指南)
- [配置说明](#配置说明)
- [快速开始](#快速开始)
- [详细使用教程](#详细使用教程)
- [命令行参数](#命令行参数)
- [输出格式说明](#输出格式说明)
- [高级功能](#高级功能)
- [故障排除](#故障排除)
- [常见问题](#常见问题)

## 项目概述

医学智能文献检索与综述生成系统是一个基于AI技术的学术研究辅助工具，专为医学科研工作者设计。系统能够自动化完成从PubMed文献检索到综述生成的全流程，大幅提升研究效率。

### 核心特色
- **AI驱动的需求分析**：智能理解用户查询意图，自动生成优化的检索策略
- **PubMed深度整合**：直接访问PubMed数据库，获取最新最权威的文献
- **多维度智能筛选**：结合期刊影响因子、分区信息进行质量筛选
- **自动化综述生成**：基于文献内容生成结构化综述大纲和完整文章
- **跨平台支持**：Windows、macOS、Linux全平台兼容

## 系统功能

### 1. 智能文献检索
- **需求理解**：自然语言查询转换为精准的PubMed检索表达式
- **多源检索**：支持PubMed、PMC等主要医学数据库
- **实时获取**：直接从PubMed API获取最新文献数据
- **批量处理**：支持大规模文献检索和处理

### 2. 智能文献筛选
- **期刊质量评估**：基于JCR影响因子和中科院分区进行筛选
- **时间范围筛选**：支持自定义发表时间范围
- **关键词匹配**：智能匹配研究主题相关性
- **去重处理**：自动识别和处理重复文献

### 3. 综述内容生成
- **大纲自动生成**：基于文献内容生成结构化综述大纲
- **章节内容编写**：AI辅助生成各章节详细内容
- **引用管理**：自动处理文献引用和参考文献列表
- **多种输出格式**：支持Word、Markdown、PDF等格式

### 4. 数据导出功能
- **CSV表格**：便于Excel分析处理
- **JSON数据**：程序化处理和数据交换
- **BibTeX格式**：学术写作引用管理
- **文本报告**：可读性强的文献摘要报告

## 环境要求

### 系统要求
- **操作系统**：Windows 10+、macOS 10.14+、Ubuntu 18.04+
- **Python版本**：Python 3.8 或更高版本
- **内存**：建议4GB以上RAM
- **存储空间**：至少1GB可用空间
- **网络连接**：需要访问PubMed和AI服务API

### 依赖包要求
系统会自动检测和安装所需依赖包，主要包括：
- pandas >= 2.0.0（数据处理）
- requests >= 2.28.0（网络请求）
- aiohttp >= 3.8.0（异步HTTP）
- lxml >= 4.9.0（XML解析）
- PyYAML >= 6.0（配置文件）

## 安装指南

### 方式一：快速安装（推荐）

1. **下载系统文件**
   ```bash
   # 下载项目到本地
   git clone [项目地址]
   cd Intelligent-Literature-Review
   ```

2. **运行自动安装脚本**
   
   **Windows用户**：
   ```bash
   # PowerShell脚本（推荐）
   start.ps1
   ```
   
   **macOS/Linux用户**：
   ```bash
   chmod +x start.sh
   ./start.sh
   ```

3. **系统自动完成**：
   - 检测Python环境
   - 创建虚拟环境
   - 安装所有依赖包
   - 启动系统

### 方式二：手动安装

1. **创建虚拟环境**
   ```bash
   python -m venv venv
   
   # Windows激活
   venv\Scripts\activate
   
   # macOS/Linux激活
   source venv/bin/activate
   ```

2. **安装依赖包**
   ```bash
   pip install -r requirements.txt
   ```

3. **启动系统**
   ```bash
   python intelligent_literature_system.py
   ```

## 配置说明

### AI模型配置

系统需要配置AI模型来进行智能分析。创建或编辑 `ai_config.yaml` 文件：

```yaml
ai_services:
  gemini-cli:
    api_key: 'your_api_key'
    api_type: gemini
    base_url: https://your-service-url/
    default_model: 
    description: Gemini AI服务
    name: gemini-cli
    status: active
    timeout: 900
    
default_service: gemini-cli
settings:
  allow_service_switch: true
  auto_retry: true
  max_retries: 3
  show_service_status: true
```

### 期刊数据配置

系统使用期刊排名数据进行文献质量评估：

1. **放置数据文件**：
   - 将 `jcr.csv`（JCR影响因子数据）放入 `data/` 目录
   - 将 `zky.csv`（中科院分区数据）放入 `data/` 目录

2. **数据格式要求**：
   - CSV格式，包含期刊名称、影响因子、分区等信息
   - 系统会自动处理和优化数据格式

3. **可选配置**：
   - 如果没有期刊数据，系统将使用基础筛选功能
   - 系统会自动生成 `processed_*.csv` 优化文件

## 快速开始

### 第一次使用

1. **启动系统**
   ```bash
   # Windows PowerShell（推荐）
   start.ps1
   
   # macOS/Linux  
   ./start.sh
   
   # 或直接使用Python增强启动器
   python src/start.py
   
   # 或直接运行主程序
   python intelligent_literature_system.py
   ```

2. **配置AI服务**
   - 首次启动会提示配置AI服务
   - 输入API密钥和服务地址
   - 系统会自动保存配置

3. **进行第一次检索**
   - 选择"智能文献系统"
   - 输入研究主题，如："糖尿病治疗"
   - 系统会自动分析并开始检索

### 基本操作流程

```
用户输入查询 → AI分析意图 → 生成检索策略 → PubMed检索 → 智能筛选 → 结果导出
```

## 详细使用教程

### 1. 使用启动脚本（推荐）

#### 启动方式
```bash
# Windows用户
start.ps1

# macOS/Linux用户
./start.sh

# 跨平台Python启动器
python src/start.py
```

系统启动后会自动进入交互模式，显示主菜单：

```
==================================================
智能文献系统主菜单
==================================================
1. 系统状态检查
2. 智能文献系统  
3. 高级设置
4. 帮助文档
0. 退出
```

#### 使用智能文献系统

**步骤1：选择功能**
```
选择你的需求: 2
```

**步骤2：输入研究主题**
```
请输入您的检索需求（例如：糖尿病治疗近5年高影响因子研究）:
>>> 糖尿病治疗近5年高影响因子研究
```

**步骤3：AI智能分析**
- 系统会自动分析您的查询意图
- 生成优化的PubMed检索表达式
- 显示分析结果和检索策略

**AI分析示例：**
```
[AI] 正在分析检索需求: 糖尿病治疗近5年高影响因子研究
[AI] 意图分析完成:
   - 主题关键词: diabetes, treatment, therapy
   - 时间限制: 2019-2024 (近5年)
   - 质量要求: 高影响因子期刊
   - 研究类型: 治疗相关研究

[AI] 生成PubMed检索表达式:
检索表达式: (("diabetes mellitus"[MeSH Terms] OR "diabetes"[All Fields]) AND ("therapeutics"[MeSH Terms] OR "treatment"[All Fields] OR "therapy"[All Fields]) AND ("2019/01/01"[Date - Publication] : "2024/12/31"[Date - Publication]))

[AI] 检索策略优化:
   - 使用MeSH主题词确保检索准确性
   - 结合自由词扩大检索范围
   - 限定近5年发表文献
   - 系统将自动筛选高影响因子期刊
```

**步骤4：设置检索数量**
```
[STAT] 根据您的检索需求，共找到约 1250 篇相关文献
==================================================
请输入要获取的文献数量 (1-1250, 建议50-200): 100
[OK] 将获取 100 篇文献（按相关性从高到低排序）
```

**步骤5：文献检索和筛选**
- 系统自动从PubMed获取文献数据
- 进行期刊质量筛选（基于影响因子和分区）
- 显示筛选进度和统计信息

**步骤6：结果导出**
- 系统会自动生成多种格式的结果文件
- CSV格式：详细的文献数据表格
- JSON格式：结构化数据文件
- 显示保存路径和文件信息

### 2. 命令行模式使用

#### 直接交互模式
如果您需要直接运行主程序而不使用启动脚本：

```bash
# 直接启动交互模式
python intelligent_literature_system.py
```

#### 命令行参数模式
```bash
# 检索糖尿病相关文献，限制50篇，输出CSV格式
python intelligent_literature_system.py -q "diabetes treatment" -n 50 -f csv

# 检索COVID-19疫苗文献，输出JSON格式
python intelligent_literature_system.py -q "COVID-19 vaccines" -f json

# 指定时间范围的检索
python intelligent_literature_system.py -q "hypertension drugs" -n 100 --start-year 2020 --end-year 2024
```

#### 综述大纲生成
```bash
# 生成6000字的综述大纲
python intelligent_literature_system.py -q "心血管疾病预防" --generate-outline --target-words 6000

# 从已有文献生成大纲
python intelligent_literature_system.py --outline-from-file literature_results.json --outline-topic "心血管疾病治疗"
```

#### 高级筛选选项
```bash
# 指定期刊影响因子范围
python intelligent_literature_system.py -q "cancer immunotherapy" --min-impact-factor 5.0

# 只检索高质量期刊（Q1区）
python intelligent_literature_system.py -q "gene therapy" --journal-quartile Q1

# 排除综述类文章
python intelligent_literature_system.py -q "machine learning" --exclude-reviews
```

### 3. 批量处理示例

#### 批量主题检索
```bash
# 创建主题列表文件 topics.txt
echo "diabetes treatment
COVID-19 vaccines  
cancer immunotherapy
machine learning in medicine" > topics.txt

# 批量检索脚本
for topic in $(cat topics.txt); do
  python intelligent_literature_system.py -q "$topic" -n 50 -f csv -o "${topic// /_}_results.csv"
done
```

## 命令行参数

### 基础参数
- `-q, --query`：研究查询主题（必需）
- `-n, --num-results`：检索文献数量（默认50）
- `-f, --format`：输出格式（csv/json/txt/bibtex）
- `-o, --output`：输出文件名

### 时间筛选
- `--start-year`：开始年份
- `--end-year`：结束年份
- `--recent-years`：最近N年的文献

### 期刊质量筛选
- `--min-impact-factor`：最小影响因子
- `--max-impact-factor`：最大影响因子
- `--journal-quartile`：期刊分区（Q1/Q2/Q3/Q4）
- `--cas-partition`：中科院分区（1/2/3/4）

### 大纲生成
- `--generate-outline`：生成综述大纲
- `--target-words`：目标字数
- `--outline-from-file`：从文件生成大纲
- `--outline-topic`：大纲主题

### 系统控制
- `--debug`：调试模式
- `--verbose`：详细输出
- `--config`：指定配置文件
- `--cache-disable`：禁用缓存

## 输出格式说明

### CSV格式输出
包含字段：
- Title：文献标题
- Authors：作者列表
- Journal：期刊名称
- Year：发表年份
- PMID：PubMed ID
- DOI：数字对象标识符
- Abstract：摘要内容
- Impact_Factor：影响因子
- CAS_Partition：中科院分区
- Keywords：关键词

### JSON格式输出
```json
{
  "search_info": {
    "query": "diabetes treatment",
    "total_results": 50,
    "search_time": "2024-01-15 10:30:00"
  },
  "literature": [
    {
      "pmid": "12345678",
      "title": "Novel approaches to diabetes treatment",
      "authors": ["Smith J", "Johnson A"],
      "journal": "Diabetes Care",
      "year": 2023,
      "doi": "10.1234/dc23-1234",
      "abstract": "...",
      "impact_factor": 16.2,
      "cas_partition": 1,
      "keywords": ["diabetes", "treatment", "insulin"]
    }
  ]
}
```

### 综述大纲格式
```markdown
# 糖尿病药物治疗进展综述

## 1. 引言
- 糖尿病流行病学现状
- 治疗需求与挑战

## 2. 传统药物治疗
### 2.1 胰岛素治疗
### 2.2 口服降糖药
### 2.3 治疗效果评估

## 3. 新型药物研发
### 3.1 GLP-1受体激动剂
### 3.2 SGLT2抑制剂
### 3.3 联合治疗策略

## 4. 个性化治疗
### 4.1 基因型指导用药
### 4.2 精准医学应用

## 5. 未来发展方向
## 6. 结论

参考文献 (n=50)
```

## 高级功能

### 1. 自定义筛选规则

创建自定义筛选配置文件 `filter_config.yaml`：

```yaml
filter_rules:
  impact_factor:
    min: 3.0
    max: 50.0
  publication_year:
    start: 2020
    end: 2024
  journal_categories:
    - "Medicine"
    - "Biochemistry"
  keywords_include:
    - "clinical trial"
    - "randomized"
  keywords_exclude:
    - "case report"
    - "editorial"
```

使用自定义配置：
```bash
python intelligent_literature_system.py -q "cancer treatment" --filter-config filter_config.yaml
```

### 2. 多语言支持

系统支持多种语言的查询和输出：
```bash
# 中文查询
python intelligent_literature_system.py -q "糖尿病治疗" --lang zh

# 英文查询（默认）
python intelligent_literature_system.py -q "diabetes treatment" --lang en
```

### 3. 结果去重和合并

```bash
# 合并多个检索结果
python intelligent_literature_system.py --merge-files result1.json result2.json -o merged_results.json

# 去重处理
python intelligent_literature_system.py --deduplicate literature_results.json -o unique_results.json
```

### 4. 统计分析功能

```bash
# 生成统计报告
python intelligent_literature_system.py --analyze literature_results.json -o analysis_report.html

# 按年份统计
python intelligent_literature_system.py --stats-by-year literature_results.json

# 按期刊统计
python intelligent_literature_system.py --stats-by-journal literature_results.json
```

## 故障排除

### 常见错误及解决方案

#### 1. Python环境问题

**错误**：`Python版本过低` 或 `找不到Python`
```bash
[错误] 需要Python 3.8或更高版本
```

**解决方案**：
```bash
# 检查Python版本
python --version

# 安装Python 3.8+
# Windows: 从python.org下载安装
# macOS: brew install python@3.9  
# Ubuntu: sudo apt install python3.9
```

#### 2. 虚拟环境问题

**错误**：虚拟环境创建失败
```bash
[错误] 创建虚拟环境失败
```

**解决方案**：
```bash
# 清除现有虚拟环境
rm -rf venv  # Linux/macOS
rmdir /s venv  # Windows

# 重新创建
python -m venv venv
```

#### 3. 依赖包安装问题

**错误**：`pip install失败` 或 `包不兼容`
```bash
[错误] 依赖包安装失败: network error
```

**解决方案**：
```bash
# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 更新pip
python -m pip install --upgrade pip

# 清除pip缓存
pip cache purge
```

#### 4. AI服务配置问题

**错误**：`AI服务连接失败`
```bash
[错误] AI服务初始化失败: API key invalid
```

**解决方案**：
1. 检查 `ai_config.yaml` 配置文件
2. 确认API密钥正确
3. 验证服务URL可访问
4. 检查网络连接

#### 5. PubMed API问题

**错误**：`PubMed检索失败`
```bash
[错误] PubMed API请求失败: rate limit exceeded
```

**解决方案**：
```bash
# 减少并发请求
python intelligent_literature_system.py -q "query" --max-concurrent 2

# 添加请求延迟
python intelligent_literature_system.py -q "query" --request-delay 1

# 检查网络连接
curl -I https://eutils.ncbi.nlm.nih.gov/entrez/eutils/
```

#### 6. 内存不足问题

**错误**：`内存不足` 或 `系统变慢`
```bash
[警告] 内存使用过高: 85%
```

**解决方案**：
```bash
# 减少检索数量
python intelligent_literature_system.py -q "query" -n 50

# 启用内存优化模式
python intelligent_literature_system.py -q "query" --memory-optimize

# 分批处理
python intelligent_literature_system.py -q "query" --batch-size 10
```

### 调试模式使用

启用调试模式获取详细错误信息：
```bash
python intelligent_literature_system.py -q "query" --debug --verbose
```

调试输出包括：
- 详细错误堆栈
- API请求响应
- 系统资源使用
- 执行时间统计

### 日志文件查看

系统会生成日志文件，位置：
- Windows: `logs/system.log`
- macOS/Linux: `logs/system.log`

查看最新日志：
```bash
# 查看完整日志
cat logs/system.log

# 查看最新50行
tail -50 logs/system.log

# 实时监控日志
tail -f logs/system.log
```

## 常见问题

### Q1：系统支持哪些操作系统？
**A**：支持Windows 10+、macOS 10.14+、Ubuntu 18.04+等主流操作系统。

### Q2：需要什么Python版本？
**A**：需要Python 3.8或更高版本，推荐使用Python 3.9或3.10。

### Q3：如何获取AI服务的API密钥？
**A**：需要注册相应的AI服务提供商账号，如Gemini、ChatGPT等，获取API密钥。

### Q4：可以检索多少篇文献？
**A**：理论上没有限制，但建议单次检索不超过1000篇，以保证处理效率。

### Q5：系统是否支持中文检索？
**A**：是的，系统支持中英文查询，会自动翻译并优化检索策略。

### Q6：如何导入自己的文献数据？
**A**：可以将JSON格式的文献数据放入指定目录，使用 `--outline-from-file` 参数处理。

### Q7：生成的综述大纲可以编辑吗？
**A**：可以，生成的大纲保存为Markdown格式，可以自由编辑和修改。

### Q8：系统如何保证文献质量？
**A**：通过期刊影响因子、中科院分区、发表时间等多个维度进行质量筛选。

### Q9：可以批量处理多个主题吗？
**A**：可以，支持命令行批量处理和脚本自动化执行。

### Q10：遇到网络问题怎么办？
**A**：可以配置代理服务器，或使用 `--retry` 参数增加重试次数。

---
